<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ¢ - HabitPilot</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f0f2f5;
    }

    .demo-container {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
    }

    h1 {
      color: #1a73e8;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #5f6368;
      margin-bottom: 32px;
    }

    .demo-section {
      margin-bottom: 32px;
      padding: 24px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .demo-section h2 {
      font-size: 18px;
      color: #202124;
      margin-bottom: 16px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .demo-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .demo-btn.primary {
      background: #1a73e8;
      color: white;
    }

    .demo-btn.primary:hover {
      background: #1557b0;
    }

    .demo-btn.secondary {
      background: white;
      color: #1a73e8;
      border: 1px solid #dadce0;
    }

    .demo-btn.secondary:hover {
      background: #f8f9fa;
    }

    .status-panel {
      background: white;
      padding: 16px;
      border-radius: 6px;
      border: 1px solid #dadce0;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }

    .status-value {
      font-weight: 500;
      color: #1a73e8;
    }

    .log-container {
      background: #202124;
      color: #9aa0a6;
      padding: 16px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 16px;
    }

    .log-entry {
      margin-bottom: 4px;
    }

    .log-entry.success {
      color: #81c995;
    }

    .log-entry.error {
      color: #f28b82;
    }

    .habit-demo {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .habit-card {
      background: white;
      border: 1px solid #dadce0;
      border-radius: 6px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .habit-card:hover {
      border-color: #1a73e8;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.2);
    }

    .habit-card.scheduled {
      border-color: #34a853;
      background: #e8f5e9;
    }

    .settings-link {
      display: inline-block;
      margin-top: 16px;
      color: #1a73e8;
      text-decoration: none;
      font-weight: 500;
    }

    .settings-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <h1>ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ¢</h1>
    <p class="subtitle">HabitPiloté€šçŸ¥æ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</p>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="demo-section">
      <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
      <div class="status-panel">
        <div class="status-item">
          <span>é€šçŸ¥æ¨©é™</span>
          <span class="status-value" id="permissionStatus">ç¢ºèªä¸­...</span>
        </div>
        <div class="status-item">
          <span>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</span>
          <span class="status-value" id="activeReminders">0</span>
        </div>
        <div class="status-item">
          <span>æ¬¡å›é€šçŸ¥äºˆå®š</span>
          <span class="status-value" id="nextNotification">ãªã—</span>
        </div>
      </div>
    </div>

    <!-- åŸºæœ¬æ©Ÿèƒ½ãƒ‡ãƒ¢ -->
    <div class="demo-section">
      <h2>ğŸš€ åŸºæœ¬æ©Ÿèƒ½</h2>
      <div class="button-group">
        <button class="demo-btn primary" onclick="requestPermission()">
          é€šçŸ¥æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        </button>
        <button class="demo-btn secondary" onclick="sendSimpleNotification()">
          ã‚·ãƒ³ãƒ—ãƒ«é€šçŸ¥
        </button>
        <button class="demo-btn secondary" onclick="sendRichNotification()">
          ãƒªãƒƒãƒé€šçŸ¥
        </button>
        <button class="demo-btn secondary" onclick="checkSettings()">
          è¨­å®šã‚’ç¢ºèª
        </button>
      </div>
      <a href="notification-settings.html" class="settings-link">âš™ï¸ è©³ç´°è¨­å®šç”»é¢ã‚’é–‹ã</a>
    </div>

    <!-- ç¿’æ…£ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ‡ãƒ¢ -->
    <div class="demo-section">
      <h2>â° ç¿’æ…£ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</h2>
      <p style="color: #5f6368; margin-bottom: 16px;">ç¿’æ…£ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¨­å®š</p>
      <div class="habit-demo" id="habitGrid">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="demo-section">
      <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
      <div class="log-container" id="logContainer">
        <div class="log-entry">ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...</div>
      </div>
    </div>
  </div>

  <script src="notification-system.js"></script>
  <script>
    // ãƒ‡ãƒ¢ç”¨ç¿’æ…£ãƒ‡ãƒ¼ã‚¿
    const demoHabits = [
      { id: 'water', name: 'ğŸ’§ æ°´åˆ†è£œçµ¦', emoji: 'ğŸ’§' },
      { id: 'stretch', name: 'ğŸ§˜ ã‚¹ãƒˆãƒ¬ãƒƒãƒ', emoji: 'ğŸ§˜' },
      { id: 'walk', name: 'ğŸš¶ æ•£æ­©', emoji: 'ğŸš¶' },
      { id: 'journal', name: 'ğŸ“ æ—¥è¨˜', emoji: 'ğŸ“' },
      { id: 'meditate', name: 'ğŸ§˜â€â™€ï¸ ç‘æƒ³', emoji: 'ğŸ§˜â€â™€ï¸' },
      { id: 'vitamins', name: 'ğŸ’Š ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ', emoji: 'ğŸ’Š' }
    ];

    // ãƒ­ã‚°è¡¨ç¤º
    function addLog(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString('ja-JP');
      entry.textContent = `[${timestamp}] ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    function updateStatus() {
      // æ¨©é™çŠ¶æ…‹
      const permission = Notification.permission;
      const permissionEl = document.getElementById('permissionStatus');
      permissionEl.textContent = {
        'granted': 'âœ… è¨±å¯æ¸ˆã¿',
        'denied': 'âŒ æ‹’å¦',
        'default': 'â¸ï¸ æœªè¨­å®š'
      }[permission] || 'ä¸æ˜';

      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼æ•°
      const activeCount = window.notificationSystem.scheduledNotifications.size;
      document.getElementById('activeReminders').textContent = activeCount;

      // æ¬¡å›é€šçŸ¥
      let nextTime = null;
      window.notificationSystem.scheduledNotifications.forEach(schedule => {
        if (!nextTime || schedule.nextNotification < nextTime) {
          nextTime = schedule.nextNotification;
        }
      });
      
      document.getElementById('nextNotification').textContent = 
        nextTime ? nextTime.toLocaleTimeString('ja-JP') : 'ãªã—';
    }

    // æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    async function requestPermission() {
      addLog('é€šçŸ¥æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã¾ã™...');
      const result = await window.notificationSystem.requestPermission();
      
      if (result === 'granted') {
        addLog('é€šçŸ¥æ¨©é™ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼', 'success');
      } else {
        addLog(`é€šçŸ¥æ¨©é™: ${result}`, 'error');
      }
      
      updateStatus();
    }

    // ã‚·ãƒ³ãƒ—ãƒ«é€šçŸ¥
    function sendSimpleNotification() {
      addLog('ã‚·ãƒ³ãƒ—ãƒ«é€šçŸ¥ã‚’é€ä¿¡...');
      window.notificationSystem.showNotification('HabitPilot', {
        body: 'ã“ã‚Œã¯ã‚·ãƒ³ãƒ—ãƒ«ãªé€šçŸ¥ã§ã™'
      });
      addLog('ã‚·ãƒ³ãƒ—ãƒ«é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
    }

    // ãƒªãƒƒãƒé€šçŸ¥
    function sendRichNotification() {
      addLog('ãƒªãƒƒãƒé€šçŸ¥ã‚’é€ä¿¡...');
      window.notificationSystem.showNotification('ç¿’æ…£é”æˆãŠã‚ã§ã¨ã†ï¼ ğŸ‰', {
        body: 'ä»Šæ—¥ã‚‚ç´ æ™´ã‚‰ã—ã„ä¸€æ—¥ã§ã—ãŸã€‚æ˜æ—¥ã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
        icon: 'ğŸ†',
        badge: 'âœ¨',
        image: 'https://via.placeholder.com/300x150?text=Great+Job!',
        actions: [
          { action: 'view', title: 'è©³ç´°ã‚’è¦‹ã‚‹' },
          { action: 'dismiss', title: 'é–‰ã˜ã‚‹' }
        ]
      });
      addLog('ãƒªãƒƒãƒé€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
    }

    // è¨­å®šç¢ºèª
    function checkSettings() {
      const settings = window.notificationSystem.settings;
      addLog('ç¾åœ¨ã®è¨­å®š:');
      addLog(`- é€šçŸ¥æœ‰åŠ¹: ${settings.enabled ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
      addLog(`- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ™‚é–“: ${settings.defaultTime}`);
      addLog(`- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé »åº¦: ${settings.defaultFrequency}`);
      addLog(`- ç¿’æ…£åˆ¥è¨­å®š: ${Object.keys(settings.habits).length}å€‹`);
    }

    // ç¿’æ…£ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆ
    function renderHabitGrid() {
      const grid = document.getElementById('habitGrid');
      grid.innerHTML = '';
      
      demoHabits.forEach(habit => {
        const card = document.createElement('div');
        card.className = 'habit-card';
        card.id = `habit-${habit.id}`;
        
        const isScheduled = window.notificationSystem.scheduledNotifications.has(habit.id);
        if (isScheduled) {
          card.classList.add('scheduled');
        }
        
        card.innerHTML = `
          <div style="font-size: 32px; margin-bottom: 8px;">${habit.emoji}</div>
          <div style="font-weight: 500;">${habit.name}</div>
          <div style="font-size: 12px; color: #5f6368; margin-top: 4px;">
            ${isScheduled ? 'âœ… è¨­å®šæ¸ˆã¿' : 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨­å®š'}
          </div>
        `;
        
        card.onclick = () => toggleHabitReminder(habit);
        grid.appendChild(card);
      });
    }

    // ç¿’æ…£ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ
    function toggleHabitReminder(habit) {
      const isScheduled = window.notificationSystem.scheduledNotifications.has(habit.id);
      
      if (isScheduled) {
        window.notificationSystem.cancelHabitReminder(habit.id);
        addLog(`${habit.name} ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ`);
      } else {
        // ãƒ‡ãƒ¢ç”¨ã«ç¾åœ¨æ™‚åˆ»ã‹ã‚‰1åˆ†å¾Œã«è¨­å®š
        const now = new Date();
        now.setMinutes(now.getMinutes() + 1);
        const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        
        window.notificationSystem.scheduleHabitReminder(habit.id, time, 'hourly');
        addLog(`${habit.name} ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ (${time})`, 'success');
        
        // ãƒ‡ãƒ¢ç”¨ã«5ç§’å¾Œã«é€šçŸ¥
        setTimeout(() => {
          window.notificationSystem.showNotification(
            `${habit.emoji} ${habit.name}ã®æ™‚é–“ã§ã™ï¼`,
            {
              body: 'ç¿’æ…£ã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†',
              icon: habit.emoji,
              timestamp: Date.now()
            }
          );
        }, 5000);
      }
      
      renderHabitGrid();
      updateStatus();
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      addLog('é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ', 'success');
      updateStatus();
      renderHabitGrid();
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å®šæœŸæ›´æ–°
      setInterval(updateStatus, 1000);
    });

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', (e) => {
      if (e.key === 'n' && e.ctrlKey) {
        sendSimpleNotification();
      }
    });
  </script>
</body>
</html>